<div ui-sortable="sortableOptions" ng-model="fields">

  <div ng-repeat="field in fields" class="panel panel-default form-field {{ field.deleted ? 'hide' : '' }}" id="form-field-{{ field.id }}">
    <div class="panel-heading" ng-click="toggleFieldConfig(field)">
      <h3 class="panel-title"><abbr title="required" ng-if="(field.required == true) || (field.required == '1')">*</abbr>
        {{ field.en_label || field.fr_label }}
        <%= link_to '', "ng-click" => "removeField(field)", class: 'pull-right link-delete', title: "Click to delete this field" do %>
          <i class='fa fa-trash-o'></i>
        <% end %>
      </h3>
    </div>

    <div class="panel-body">
      <!-- single line -->
      <input type="text" class="form-control" ng-if="field.field_type == 'single_line'" name="{{ field.name }}">

      <!-- paragraph -->
      <textarea class="form-control" rows="3" ng-if="field.field_type == 'paragraph'" name="{{ field.name }}"></textarea>

      <!-- boolean -->
      <div class="radio" ng-if="field.field_type == 'boolean'">
        <label>
          <input type="radio" name="{{ field.name }}" value="1" checked>
          {{ field.properties.true_label }}
        </label>
      </div>
      <div class="radio" ng-if="field.field_type == 'boolean'">
        <label>
          <input type="radio" name="{{ field.name }}" value="0" checked>
          {{ field.properties.false_label }}
        </label>
      </div>

      <!-- MCQ -->
      <div class="checkbox" ng-repeat="opt in field.field_options" ng-if="(field.field_type == 'mcq') && ((opt.deleted == undefined) || (opt.deleted == false))">
        <label>
          <input type="checkbox"> {{ opt.name }}
        </label>
      </div>

      <!-- rating -->
      <div class="radio-inline" ng-repeat="opt in field.field_options" ng-if="(field.field_type == 'rating') && ((opt.deleted == undefined) || (opt.deleted == false))">
        <label>
          <input type="radio" name="{{ field.name }}[{{ opt.name }}]" value="{{ opt.name }}">
          {{ opt.name }}
        </label>
      </div>

      <!-- dropdown -->
      <!-- <select class="form-control" ng-show="(field.field_type = 'dropdown')">
        <option> {{ opt.name }} </option>
      </select> -->

      <!-- price -->
      <div class="input-group price" ng-show="(field.field_type == 'price')">
        <input type="text" class="form-control span3">
        <span class="input-group-addon"> {{ field.properties.currency || '$' }}</span>
      </div>

      <p class="help-block" ng-if="field.en_hint != ''"> {{ field.en_hint }} </p>
    </div>
    <!-- end panel body -->

    <!-- field options -->
    <div class='panel-footer hide field-config-container'>
      <h6>FIELD SETTINGS</h6>
      <%= f.fields_for 'fields_attributes[{{field.id}}]' do |ff| %>
        <%= ff.hidden_field :id, value: "{{ field.id }}", 'ng-if' => "field.persisted == true" %>
        <%= ff.hidden_field :_destroy, value: "{{ field.deleted }}", 'ng-if' => "field.persisted == true" %>
        <%= ff.hidden_field :field_type, value: "{{ field.field_type }}" %>
        <%= ff.hidden_field :position, value: "{{ field.position }}" %>
        <%= ff.hidden_field :name, input_html: { 'ng-model' => "field.name", 'ng-blur' => "underscorizeFieldName(field)" } %>
        <%= ff.input :en_label, label: 'Label', as: :string, input_html:  { 'ng-model' => "field.en_label", id: nil } %>
        <%= ff.input :en_hint, label: 'Hint', as: :string, input_html:   { 'ng-model' => "field.en_hint", id: nil } %>
        <div class="checkbox">
          <label><%= ff.check_box :required, { 'ng-model' => "field.required", id: nil } %> Required</label>
        </div>
        <div class="row">
          <div class="col-xs-6">
            <%= ff.input :true_label, placeholder: "Yes", input_html: { 'ng-model' => "field.properties.true_label", id: nil } %>
          </div>
          <div class="col-xs-6">
            <%= ff.input :false_label, placeholder: "No", input_html: { 'ng-model' => "field.properties.false_label", id: nil } %>
          </div>
        </div>

        <h6>FIELD OPTIONS</h6>
        <div ng-repeat="field_option in field.field_options" class="row {{ field_option.deleted ? 'hide' : '' }}">
          <%= ff.fields_for "field_options_attributes[{{ field_option.id }}]" do |fo| %>
            <div class="col-xs-11">
              <%= fo.input :name, as: :string, label: false, input_html: { 'ng-model' => 'field_option.name' }, placeholder: 'Value' %>
              <%= fo.hidden_field :id, 'value' => '{{ field_option.id }}', 'ng-if' => "field_option.persisted == true" %>
              <%= fo.hidden_field :_destroy, 'value' => '{{ field_option.deleted }}', 'ng-if' => "field_option.persisted == true" %>
            </div>
            <div class="col-xs-1" style='text-align:left;'>
              <%= link_to 'remove', '', 'ng-click' => "removeFieldOption(field, field_option)", class: 'link-danger' %>
            </div>
          <% end %>
        </div>
        <p><%= link_to "Add Option", '', 'ng-click' => "addFieldOption(field)" %></p>
      <% end %>
    </div> <!-- end panel footer -->
  </div> <!-- end panel -->
</div> <!-- end fields -->